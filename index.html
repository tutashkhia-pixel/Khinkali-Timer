<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Khinkali Timer</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta property="og:image" content="logo.png">
  <meta name="twitter:card" content="summary_large_image">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #f5f5f5;
      text-align: center;
      padding: 3rem;
    }
    h1 {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }
    .timer {
      font-size: 5rem;
      margin-top: 2rem;
    }
    .khinkali {
      width: 120px;
      margin: 2rem auto;
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    .footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      opacity: 0.7;
    }
    .timer-controls {
      margin-top: 2rem;
    }
    #timeInput {
      padding: 10px;
      font-size: 16px;
      width: 200px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px 5px;
      border-radius: 6px;
      background-color: #a65cf1;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <img src="logo.png" alt="Khinkali" class="khinkali" />
  <h1>Khinkali Timer</h1>

  <div class="timer-controls">
    <input id="timeInput" placeholder="e.g. 17m30s or 1h" />
    <button onclick="startTimer()">Start</button>
    <button onclick="togglePause()">Pause</button>
    <button onclick="resetTimer()">Reset</button>
  </div>

  <div id="countdown" class="timer">00:00</div>
  <div class="footer">Bring focus to your study or work. Powered by Khinkali ðŸ¥Ÿ</div>

  <script>
    let seconds = 0;
    let timerInterval = null;
    let isPaused = false;

    const display = document.getElementById("countdown");

    function updateDisplay() {
      const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
      const secs = String(seconds % 60).padStart(2, '0');
      display.textContent = `${mins}:${secs}`;
    }

    function playSound() {
      const beep = new Audio("https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg");
      beep.play();
    }

    function parseTime(input) {
      let totalSeconds = 0;
      const pattern = /(\d+)([hms])/gi;
      let match;
      while ((match = pattern.exec(input)) !== null) {
        const val = parseInt(match[1]);
        const unit = match[2].toLowerCase();
        if (unit === 'h') totalSeconds += val * 3600;
        else if (unit === 'm') totalSeconds += val * 60;
        else if (unit === 's') totalSeconds += val;
      }
      return totalSeconds;
    }

    function startTimer() {
      clearInterval(timerInterval);
      const input = document.getElementById('timeInput').value.trim();
      const totalSeconds = parseTime(input);
      if (!totalSeconds) {
        alert("Please enter a valid time (e.g. 17m30s, 1h, or 90s).");
        return;
      }

      seconds = totalSeconds;
      updateDisplay();
      isPaused = false;

      timerInterval = setInterval(() => {
        if (!isPaused && seconds > 0) {
          seconds--;
          updateDisplay();
        } else if (seconds <= 0) {
          playSound();
          clearInterval(timerInterval);
        }
      }, 1000);
    }

    function togglePause() {
      isPaused = !isPaused;
    }

    function resetTimer() {
      clearInterval(timerInterval);
      seconds = 0;
      updateDisplay();
    }

    // Optional: Start timer if URL path includes time (e.g. /5m)
    function parseFromPath() {
      const path = window.location.pathname.substring(1).toLowerCase();
      if (path) {
        document.getElementById('timeInput').value = path;
        startTimer();
      }
    }

    updateDisplay();
    parseFromPath();
  </script>

  <audio id="alarm-sound">
    <source src="alarm_en.mp3" type="audio/mpeg" />
  </audio>
  <script>
    const langAudioMap = {
      'ka': 'alarm_ka.mp3',
      'es': 'alarm_es.mp3',
      'fr': 'alarm_fr.mp3',
      'en': 'alarm_en.mp3'
    };
    const userLang = (navigator.language || 'en').split('-')[0];
    const alarmAudio = document.getElementById("alarm-sound");
    alarmAudio.src = langAudioMap[userLang] || langAudioMap['en'];

    const quotes = [
      "Stay dumpling-focused!",
      "One bite at a time, one task at a time.",
      "Steamy progress beats burnout.",
      "Khinkali knows: Rest = Power.",
      "Savor the silence. Focus now."
    ];
    document.querySelector(".footer").textContent = quotes[Math.floor(Math.random() * quotes.length)];
  </script>
</body>
</html>
